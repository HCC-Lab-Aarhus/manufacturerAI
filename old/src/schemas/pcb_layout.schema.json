{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "PCBLayout",
  "description": "Output of PCB Agent - complete board geometry",
  "type": "object",
  "required": ["board", "components"],
  "properties": {
    "board": {
      "type": "object",
      "required": ["outline_polygon", "thickness_mm"],
      "properties": {
        "outline_polygon": {
          "type": "array",
          "description": "Closed polygon in mm coordinates [[x,y], ...]",
          "minItems": 3,
          "items": {
            "type": "array",
            "minItems": 2,
            "maxItems": 2,
            "items": {"type": "number"}
          }
        },
        "thickness_mm": {
          "type": "number",
          "default": 1.6,
          "description": "PCB thickness"
        },
        "origin": {
          "type": "string",
          "description": "Coordinate system origin",
          "default": "bottom_left"
        }
      }
    },
    "components": {
      "type": "array",
      "items": {
        "type": "object",
        "required": ["id", "type", "center", "rotation_deg", "footprint"],
        "properties": {
          "id": {
            "type": "string",
            "description": "Component ID (e.g., SW1, U1)"
          },
          "ref": {
            "type": "string",
            "description": "Link back to requirement ID (e.g., BTN_POWER)"
          },
          "type": {
            "type": "string",
            "enum": ["button", "led", "controller", "battery", "diode", "connector"],
            "description": "Component type"
          },
          "footprint": {
            "type": "string",
            "description": "Footprint identifier (e.g., 'SW_TACTILE_6x6')"
          },
          "center": {
            "type": "array",
            "description": "[x, y] in mm",
            "minItems": 2,
            "maxItems": 2,
            "items": {"type": "number"}
          },
          "rotation_deg": {
            "type": "number",
            "default": 0,
            "description": "Rotation in degrees"
          },
          "keepout": {
            "type": "object",
            "description": "Keepout zone around component",
            "properties": {
              "type": {
                "type": "string",
                "enum": ["circle", "rectangle", "polygon"]
              },
              "radius_mm": {"type": "number"},
              "width_mm": {"type": "number"},
              "height_mm": {"type": "number"},
              "polygon": {
                "type": "array",
                "items": {
                  "type": "array",
                  "minItems": 2,
                  "maxItems": 2,
                  "items": {"type": "number"}
                }
              }
            }
          }
        }
      }
    },
    "keepout_regions": {
      "type": "array",
      "description": "Additional keepout zones",
      "items": {
        "type": "object",
        "required": ["id", "polygon"],
        "properties": {
          "id": {"type": "string"},
          "purpose": {"type": "string"},
          "polygon": {
            "type": "array",
            "items": {
              "type": "array",
              "minItems": 2,
              "maxItems": 2,
              "items": {"type": "number"}
            }
          }
        }
      }
    },
    "metadata": {
      "type": "object",
      "description": "Export metadata for UI",
      "properties": {
        "preview_image_path": {"type": "string"},
        "preview_scale": {"type": "number"},
        "generated_timestamp": {"type": "string"}
      }
    }
  }
}
